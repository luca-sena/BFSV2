<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="icon" href="./img/logoIcon.png">
    <script src="./js/sessao.js"></script>
    <link rel="stylesheet" href="./style/cadastro-style.css">
    <link rel="stylesheet" href="./style/geral-style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BFS | Cadastro</title>
</head>
<body onload="listar()">
    <section id="sec-login" class="sec-login">
        <container class="container-header">
            <a href="index.html">        
                <img class="logo" src="./img/logo.png" alt="Logo FBS">
            </a>
        </container>
        <div class="alerta_erro" style="color:azure">
            <div class="card_erro" id="cardErro">
              <span id="mensagem_erro"></span>
            </div>
          </div>

        <container class="container-login">
            
            
                <div class="border">
                    <img src="./svg/border.svg" alt="">
                </div>
         
           
            <div class="container-login-itens">

                <!-- Pessoa -->
                <div class="avatar">
                    <img src="./svg/avatar.svg" alt="">
                </div>
                <div class="input-container">
                    
                    <div class="div-input">
                        <p>Nome Completo</p>
                        <input id="nome_input" type="text">
                    </div>
                    
                    <div class="div-input">
                        <p>Data de Nascimento</p>
                        <div class="data">
                            <select id="dia_input" style="width: 50px;">
                                <option value="" disabled selected>Dia</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                                <option value="21">21</option>
                                <option value="22">22</option>
                                <option value="23">23</option>
                                <option value="24">24</option>
                                <option value="25">25</option>
                                <option value="26">26</option>
                                <option value="27">27</option>
                                <option value="28">28</option>
                                <option value="29">29</option>
                                <option value="30">30</option>
                                <option value="31">31</option>
                            </select>
                            <select id="mes_input" style="width: 150px;">
                                <option value="" disabled selected>Mês</option>
                                <option value="01">Janeiro</option>
                                <option value="02">Fevereiro</option>
                                <option value="03">Março</option>
                                <option value="04">Abril</option>
                                <option value="05">Maio</option>
                                <option value="06">Junho</option>
                                <option value="07">Julho</option>
                                <option value="08">Agosto</option>
                                <option value="09">Setembro</option>
                                <option value="10">Outubro</option>
                                <option value="11">Novembro</option>
                                <option value="12">Dezembro</option>
                            </select>
                            <select id="ano_input" style="width: 150px;">
                                <option value="" disabled selected>Ano</option>
                                <option value="2005">2005</option>
                                <option value="2004">2004</option>
                                <option value="2003">2003</option>
                                <option value="2002">2002</option>
                                <option value="2001">2001</option>
                                <option value="2000">2000</option>
                                <option value="1999">1999</option>
                                <option value="1998">1998</option>
                                <option value="1997">1997</option>
                                <option value="1996">1996</option>
                                <option value="1995">1995</option>
                                <option value="1994">1994</option>
                                <option value="1993">1993</option>
                                <option value="1992">1992</option>
                                <option value="1991">1991</option>
                                <option value="1990">1990</option>
                                <option value="1989">1989</option>
                                <option value="1988">1988</option>
                                <option value="1987">1987</option>
                                <option value="1986">1986</option>
                                <option value="1985">1985</option>
                                <option value="1984">1984</option>
                                <option value="1983">1983</option>
                                <option value="1982">1982</option>
                                <option value="1981">1981</option>
                                <option value="1980">1980</option>
                                <option value="1979">1979</option>
                                <option value="1978">1978</option>
                                <option value="1977">1977</option>
                                <option value="1976">1976</option>
                                <option value="1975">1975</option>
                                <option value="1974">1974</option>
                                <option value="1973">1973</option>
                                <option value="1972">1972</option>
                                <option value="1971">1971</option>
                                <option value="1970">1970</option>
                                <option value="1969">1969</option>
                                <option value="1968">1968</option>
                                <option value="1967">1967</option>
                                <option value="1966">1966</option>
                                <option value="1965">1965</option>
                                <option value="1964">1964</option>
                                <option value="1963">1963</option>
                                <option value="1962">1962</option>
                                <option value="1961">1961</option>
                                <option value="1960">1960</option>
                                <option value="1959">1959</option>
                                <option value="1958">1958</option>
                                <option value="1957">1957</option>
                                <option value="1956">1956</option>
                                <option value="1955">1955</option>
                                <option value="1954">1954</option>
                                <option value="1953">1953</option>
                                <option value="1952">1952</option>
                                <option value="1951">1951</option>
                                <option value="1950">1950</option>
                                <option value="1949">1949</option>
                                <option value="1948">1948</option>
                                <option value="1947">1947</option>
                                <option value="1946">1946</option>
                                <option value="1945">1945</option>
                                <option value="1944">1944</option>
                                <option value="1943">1943</option>
                                <option value="1942">1942</option>
                                <option value="1941">1941</option>
                                <option value="1940">1940</option>
                                <option value="1939">1939</option>
                                <option value="1938">1938</option>
                                <option value="1937">1937</option>
                                <option value="1936">1936</option>
                                <option value="1935">1935</option>
                                <option value="1934">1934</option>
                                <option value="1933">1933</option>
                                <option value="1932">1932</option>
                                <option value="1931">1931</option>
                                <option value="1930">1930</option>
                                <option value="1929">1929</option>
                                <option value="1928">1928</option>
                                <option value="1927">1927</option>
                                <option value="1926">1926</option>
                                <option value="1925">1925</option>
                                <option value="1924">1924</option>
                                <option value="1923">1923</option>
                                <option value="1922">1922</option>
                                <option value="1921">1921</option>
                                <option value="1920">1920</option>
                                <option value="1919">1919</option>
                                <option value="1918">1918</option>
                                <option value="1917">1917</option>
                                <option value="1916">1916</option>
                                <option value="1915">1915</option>
                                <option value="1914">1914</option>
                                <option value="1913">1913</option>
                                <option value="1912">1912</option>
                                <option value="1911">1911</option>
                                <option value="1910">1910</option>
                                <option value="1909">1909</option>
                                <option value="1908">1908</option>
                                <option value="1907">1907</option>
                                <option value="1906">1906</option>
                                <option value="1905">1905</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="div-input">
                        <p>CPF</p>
                        <input id="cpf_input" type="text" placeholder="Apenas números" maxlength="11">
                    </div>
                    
                    <div class="div-input">
                        <p>Email</p>
                        <input id="email_input" type="text">
                    </div>
                    
                    <div class="div-input">
                        <p>Telefone</p>
                        <input id="telefone_input" type="text" placeholder="DDD e Número (Apenas números)" maxlength="11">
                    </div>
                                      
                    <div class="div-input">
                        <p>Gênero</p>
                        <select id="genero_input">
                            <option value="" disabled selected>Selecione uma opção</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Feminino">Feminino</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                    
                    <div class="div-input">
                        <p>Senha</p>
                        <input id="senha_input" type="password" placeholder="De 8 à 12 caracteres">
                    </div>
                    
                    <div class="div-input">
                        <p>Confirme a Senha</p>
                        <input id="confirmacao_senha_input" type="password" placeholder="Insira novamente a senha">
                    </div>

                <!-- Endereco -->                  
    
                    
                </div>  <!-- input-container -->
                
                <div class="location">
                    <img src="./svg/pin.svg" alt="">
                </div>
                <div class="input-container">
                    
                    <div class="div-input">
                        <p>Estado</p>
                        <select id="estado_input">
                            <option value="" disabled selected>Selecione uma opção</option>
                            <option value="AC">Acre</option>
                            <option value="AL">Alagoas</option>
                            <option value="AP">Amapá</option>
                            <option value="AM">Amazonas</option>
                            <option value="BA">Bahia</option>
                            <option value="CE">Ceará</option>
                            <option value="DF">Distrito Federal</option>
                            <option value="ES">Espírito Santo</option>
                            <option value="GO">Goiás</option>
                            <option value="MA">Maranhão</option>
                            <option value="MT">Mato Grosso</option>
                            <option value="MS">Mato Grosso do Sul</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="PA">Pará</option>
                            <option value="PB">Paraíba</option>
                            <option value="PR">Paraná</option>
                            <option value="PE">Pernambuco</option>
                            <option value="PI">Piauí</option>
                            <option value="RJ">Rio de Janeiro</option>
                            <option value="RN">Rio Grande do Norte</option>
                            <option value="RS">Rio Grande do Sul</option>
                            <option value="RO">Rondônia</option>
                            <option value="RR">Roraima</option>
                            <option value="SC">Santa Catarina</option>
                            <option value="SP">São Paulo</option>
                            <option value="SE">Sergipe</option>
                            <option value="TO">Tocantins</option>
                        </select>
                    </div>
                    <div class="div-input">
                        <p>Cidade</p>
                        <input id="cidade_input" type="text">
                    </div>
                    <div class="div-input">
                        <p>Bairro</p>
                        <input id="bairro_input" type="text">
                    </div>
                    <div class="div-input">
                        <p>Rua</p>
                        <input id="rua_input" type="text">
                    </div>
                    <div class="div-input">
                        <p>Numero</p>
                        <input id="numero_input" type="number">
                    </div>
                    <div class="div-input">
                        <p>CEP</p>
                        <input id="cep_input" type="text" placeholder="Apenas números" maxlength="8">
                    </div>

                </div> <!-- input-container -->
                
                <!-- Esolaridade -->   

                <div class="book">
                    <img src="./svg/book.svg" alt="">
                </div>
                <div class="input-container">
                    
                    <div class="div-input">
                        <p>Escolaridade</p>
                        <select id="escolaridade_input">
                            <option value="" disabled selected>Selecione uma opção</option>
                            <option value="EMIT">Ensino Médio Incompleto (Treineiro)</option>
                            <option value="EMIF">Ensino Médio Incompleto (Finalizando)</option>
                            <option value="EMC">Ensino Médio Completo</option>
                            <option value="ESI">Ensino Superior Incompleto</option>
                            <option value="ESC">Ensino Superior Completo</option>
                        </select>
                    </div>
                    <div class="div-input">
                        <p>Nome da Escola/Faculdade</p>
                        <input id="nomeEscola_input" type="text">
                    </div>
                    <div class="div-input">
                        <p>Curso de Interesse</p>
                        <select name="cursos" id="curso_input">
                            <option value="" disabled selected>Selecione uma opção</option>
                        </select>
                    </div>
                    <div class="div-input">
                        <p>Regime</p>
                        <select name="regimes" id="regime_input">
                            <option value="" disabled selected>Selecione uma opção</option>
                            <option value="Presencial">Presencial</option>
                            <option value="Hibrido">Hibrido</option>
                            <option value="EAD">EAD</option>
                        </select>
                    </div>
                    <div class="div-input">
                        <p>Periodo</p>
                        <select name="periodos" id="periodo_input">
                            <option value="" disabled selected>Selecione uma opção</option>
                            <option value="Manhã">Manhã</option>
                            <option value="Tarde">Tarde</option>
                            <option value="Noite">Noite</option>
                        </select>
                    </div>
                    <div class="div-input">
                        <p>Data da Prova</p>
                        <select name="datas" id="data_input">
                            <option value="" disabled selected>Selecione uma opção</option>
                            <option value="2024-02-10 06:00:00">10/02/24 - 6:00h</option>
                            <option value="2024-02-10 09:30:00">10/02/24 - 9:30h</option>
                            
                            <option value="2024-02-12 12:30:00">12/02/24 - 12:00h</option>
                            <option value="2024-02-12 15:30:00">12/02/24 - 15:00h</option>
                           
                            <option value="2024-02-13 18:00:00">13/02/24 - 18:00h</option>
                            <option value="2024-02-13 21:30:00">13/02/24 - 21:30h</option>
                        </select>
                    </div>
                    <div class="div-input">
                        <p>Como nos conheceu?</p>  <!--ALTERAR-->
                        <select id="comoConheceu_input" type="text">
                            <option value="" disabled selected>Selecione uma opção</option>
                            <option value="Amigos">Amigos</option>
                            <option value="Parentes">Parentes</option>
                            <option value="MídiasSociais">Mídias Sociais</option>
                            <option value="Ex-Alunos">Ex-Alunos</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>

                    

                </div> <!-- input-container -->

                <button onclick="cadastrar()" class="button-cadastrar">
                    CADASTRAR
                </button>
                <div id="div_aguardar" class="loading-div" style="display: none;">
                    <img src="./assets/circle-loading.gif" id="loading-gif" />
                  </div>
                                
            </div>
            <!-- <div id="div_erros_login" style="font-size: 200px;">aaaaa</div> -->
        </container>
    </section>
</body>
</html>

<script>
    var contadorValidacao = 0
    
    function cadastrar() {
    // aguardar();
    contadorValidacao = 0

    //Recupere o valor da nova input pelo nome do id
    // Agora vá para o método fetch logo abaixo
    var nomeVar = nome_input.value;
    var cpfVar = cpf_input.value;
    var emailVar = email_input.value;
    var telefoneVar = telefone_input.value;
    var generoVar = genero_input.value;
    var senhaVar = senha_input.value;
    var confirmacaoSenhaVar = confirmacao_senha_input.value;
   
    var estadoVar = estado_input.value;
    var cidadeVar = cidade_input.value;
    var bairroVar = bairro_input.value;
    var ruaVar = rua_input.value;
    var numeroVar = numero_input.value;
    var cepVar = cep_input.value;
    
    var escolaridadeVar = escolaridade_input.value;
    var nomeEscolaVar = nomeEscola_input.value;
    var cursoVar = curso_input.value;
    var regimeVar = regime_input.value;
    var periodoVar = periodo_input.value;
    var dataVar = data_input.value;
    var comoConheceuVar = comoConheceu_input.value;

    var dtNascDiaVar = dia_input.value.toString()
    var dtNascMesVar  = mes_input.value.toString()
    var dtNascAnoVar  = ano_input.value.toString()

    var dtNascVar = `'${dtNascAnoVar}-${dtNascMesVar}-${dtNascDiaVar}'`

    // -------------- Validação Campo Vazio --------------

    if (dtNascDiaVar == "" ||
      dtNascMesVar == "" ||
      dtNascAnoVar == "" ||
      nomeVar == "" ||
      cpfVar == "" ||
      emailVar == "" ||
      telefoneVar == "" ||
      generoVar == "" ||
      senhaVar == "" ||
      confirmacaoSenhaVar == "" ||
      estadoVar == "" ||
      cidadeVar == "" ||
      bairroVar == "" ||
      ruaVar == "" ||
      numeroVar == "" ||
      cepVar == "" ||
      escolaridadeVar == "" ||
      nomeEscolaVar == "" ||
      cursoVar == "" ||
      regimeVar == "" ||
      periodoVar == "" ||
      dataVar == "" ||
      comoConheceuVar == ""
      ) {
         alert('Há campos em branco, preencha-os!')
        } else {
            contadorValidacao++
        }

    // -------------- Validação Nome --------------
    
    if (nomeVar.indexOf('@') >= 0 ||
    nomeVar.indexOf('!') >= 0 ||
    nomeVar.indexOf('#') >= 0 ||
    nomeVar.indexOf('$') >= 0 ||
    nomeVar.indexOf('%') >= 0 ||
    nomeVar.indexOf('&') >= 0 ||
    nomeVar.indexOf('.') >= 0 ||
    nomeVar.indexOf('(') >= 0 ||
    nomeVar.indexOf(')') >= 0 ||
    nomeVar.match(/[0-9]/)) {
        alert('Nomes não podem conter números ou caracteres especiais');
    } else{
        contadorValidacao++
    }

  // -------------- Validação CPF --------------

    if(cpfVar.match(/[a-zA-Z]/)||
    cpfVar.indexOf('.') >= 0 ||
    cpfVar.indexOf('-') >= 0 ||
    cpfVar.indexOf('/') >= 0 ||
    cpfVar.indexOf('(') >= 0 ||
    cpfVar.indexOf(')') >= 0 ||
    cpfVar.indexOf(' ') >= 0){
        alert('O campo CPF deve conter apenas números, sem espaços ou caracteres especiais');
    } else if (cpfVar.length != 11){
        alert('O campo CPF deve conter 11 números');
    } else {
        contadorValidacao++
    }
 
    // -------------- Validação Email --------------
   
 if(emailVar.indexOf('@') < 0){
        alert('Email inválido');
    }else {
        contadorValidacao++
    }
    
    // -------------- Validação Telefone --------------

    if(telefoneVar.match(/[a-zA-Z]/)||
     telefoneVar.indexOf('@') >= 0 ||
     telefoneVar.indexOf('!') >= 0 ||
     telefoneVar.indexOf('#') >= 0 ||
     telefoneVar.indexOf('$') >= 0 ||
     telefoneVar.indexOf('%') >= 0 ||
     telefoneVar.indexOf('.') >= 0 ||
     telefoneVar.indexOf('&') >= 0 ||
     telefoneVar.indexOf('(') >= 0 ||
     telefoneVar.indexOf(')') >= 0 ||
     telefoneVar.indexOf(' ') >= 0) {
        alert('O campo telefone deve conter apenas números, sem espaços ou caracteres especiais');
     } else if (cpfVar.length > 11) {
        alert('O campo telefone deve conter até 11 Números');
     } else {
        contadorValidacao++
     }

// -------------- Validação Senha --------------

    if(senhaVar.indexOf('@') < 0 &&
     senhaVar.indexOf('!') < 0 &&
     senhaVar.indexOf('#') < 0 &&
     senhaVar.indexOf('$') < 0 &&
     senhaVar.indexOf('%') < 0 &&
     senhaVar.indexOf('.') < 0 &&
     senhaVar.indexOf('&') < 0 &&
     senhaVar.indexOf('(') < 0 &&
     senhaVar.indexOf(')') < 0 &&
     senhaVar.indexOf(' ') < 0){
        alert('A senha deve conter ao menos 1 caractere esepecial');
     } else if (!senhaVar.match(/[a-z]/)) {
        alert('A senha deve conter ao menos 1 uma letra minúscula')
     } else if (!senhaVar.match(/[A-Z]/)) {
        alert('A senha deve conter ao menos 1 uma letra maiúscula')
     } else if (!senhaVar.match(/[0-9]/)) {
        alert('A senha deve conter ao menos 1 um número')
    } else if (senhaVar.length > 16 || senhaVar.length < 8){
         alert('A senha deve conter de 8 à 16 caracteres') 
    } else {
         contadorValidacao++
     }

// -------------- Validação Confirmação de Senha --------------
   
   if(senhaVar != confirmacaoSenhaVar){
    alert('As senhas não correspondem');
   } else {
        contadorValidacao++
     }

// -------------- Validação Cidade --------------

if (cidadeVar.indexOf('@') >= 0 ||
    cidadeVar.indexOf('!') >= 0 ||
    cidadeVar.indexOf('#') >= 0 ||
    cidadeVar.indexOf('$') >= 0 ||
    cidadeVar.indexOf('%') >= 0 ||
    cidadeVar.indexOf('&') >= 0 ||
    cidadeVar.indexOf('(') >= 0 ||
    cidadeVar.indexOf(')') >= 0 ||
    cidadeVar.match(/[0-9]/)) {
        alert('O campo cidade não pode conter números ou caracteres especiais');
    } else{
        contadorValidacao++
    }


// -------------- Validação Bairro --------------

if (bairroVar.indexOf('@') >= 0 ||
    bairroVar.indexOf('!') >= 0 ||
    bairroVar.indexOf('#') >= 0 ||
    bairroVar.indexOf('$') >= 0 ||
    bairroVar.indexOf('%') >= 0 ||
    bairroVar.indexOf('&') >= 0 ||
    bairroVar.indexOf('(') >= 0 ||
    bairroVar.indexOf(')') >= 0 ||
    bairroVar.match(/[0-9]/)) {
        alert('O campo bairro não pode conter números ou caracteres especiais');
    } else{
        contadorValidacao++
    }

// -------------- Validação Numero --------------
   
if(numeroVar.match(/[a-zA-Z]/)||
     numeroVar.indexOf('@') >= 0 ||
     numeroVar.indexOf('!') >= 0 ||
     numeroVar.indexOf('#') >= 0 ||
     numeroVar.indexOf('$') >= 0 ||
     numeroVar.indexOf('%') >= 0 ||
     numeroVar.indexOf('.') >= 0 ||
     numeroVar.indexOf('&') >= 0 ||
     numeroVar.indexOf('(') >= 0 ||
     numeroVar.indexOf(')') >= 0 ||
     numeroVar.indexOf(' ') >= 0) {
        alert('O campo numero deve conter apenas números, sem espaços ou caracteres especiais');
     }  else {
        contadorValidacao++
     }

// -------------- Validação CEP --------------

    if(cepVar.match(/[a-zA-Z]/)||
     cepVar.indexOf('@') >= 0 ||
     cepVar.indexOf('!') >= 0 ||
     cepVar.indexOf('#') >= 0 ||
     cepVar.indexOf('$') >= 0 ||
     cepVar.indexOf('%') >= 0 ||
     cepVar.indexOf('.') >= 0 ||
     cepVar.indexOf('&') >= 0 ||
     cepVar.indexOf('(') >= 0 ||
     cepVar.indexOf(')') >= 0 ||
     cepVar.indexOf(' ') >= 0) {
        alert('O campo CEP deve conter apenas números, sem espaços ou caracteres especiais');
     } else if (cepVar.length != 8) {
        alert('O campo CEP deve conter 8 Números');
     } else {
        contadorValidacao++
     }
   





if(contadorValidacao == 11){ //Valida se todas validações passaram

     fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        nomeServer: nomeVar,
        cpfServer: cpfVar,
        emailServer: emailVar,
        telefoneServer: telefoneVar,
        generoServer: generoVar,
        senhaServer: senhaVar,
        confirmacaoSenhaServer: confirmacaoSenhaVar,
        estadoServer: estadoVar,
        cidadeServer: cidadeVar,
        bairroServer: bairroVar,
        ruaServer: ruaVar,
        numeroServer: numeroVar,
        cepServer: cepVar,
        escolaridadeServer: escolaridadeVar,
        nomeEscolaServer: nomeEscolaVar,
        cursoServer: cursoVar,
        regimeServer: regimeVar,
        periodoServer: periodoVar,
        dataServer: dataVar,
        comoConheceuServer: comoConheceuVar,
        dtNascServer: dtNascVar
      }),
    })
    .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          cardErro.style.display = "block";

          alert("Cadastro realizado com sucesso! Redirecionando para tela de Login...")

          setTimeout(() => {
            window.location = "login.html";
          }, "2000");

          limparFormulario();
          finalizarAguardar();
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        finalizarAguardar();
      });

    return false;
}
  }

  function listar() {
    fetch("/cursos/listar", {
      method: "GET",
    })
      .then(function (resposta) {
        resposta.json().then((cursos) => {
          cursos.forEach((curso) => {
            curso_input.innerHTML += `<option value='${curso.idCurso}'>${curso.nomeCurso}</option>`;
          });
        });
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });
  }

  function sumirMensagem() {
    cardErro.style.display = "none";
      
}


</script>